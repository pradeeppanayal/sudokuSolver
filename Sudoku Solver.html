<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Solver</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        /* General input styles */
        input {
            border: 1px solid #000;
            max-width: 50px;
            height: 50px;
            text-align: center;
        }

        /* Styles for Sudoku grid */
        .square {
            border: 2px solid #000;
            display: inline-block;
        }

        .inline {
            display: inline-block;
        }

        .cell {
            width: 50px;
            height: 50px;
            border: 1px solid #000;
            text-align: center;
            line-height: 50px;
            overflow: hidden;
        }

        /* Autofill styling */
        .autoFilled {
            color: green;
        }
    </style>
</head>
<body>
    <div id="board"></div>
    <div id="msg"></div>
    <br />
    <button id="fill">Generate</button>
    <button id="reset">Reset</button>
    <button id="loadTest">Load Test</button>

    <script>
        $(document).ready(function () {
            const gridSize = 9;
            const regionSize = 3;

            // Prepare the board on page load
            prepareBoard();

            // Event Listeners
            $('#loadTest').on('click', loadTest);
            $('#reset').on('click', resetBoard);
            $('#fill').on('click', fillBoard);

            // Prepare Sudoku board UI
            function prepareBoard() {
                let html = '';
                for (let p = 0; p < regionSize; p++) {
                    html += '<div>';
                    for (let q = 0; q < regionSize; q++) {
                        html += "<div class='square'>";
                        for (let r = 0; r < regionSize; r++) {
                            html += '<div>';
                            for (let s = 0; s < regionSize; s++) {
                                const row = p * regionSize + r;
                                const col = q * regionSize + s;
                                html += `<div class='field inline cell' contenteditable id='field${row}_${col}' row='${row}' col='${col}'></div>`;
                            }
                            html += '</div>';
                        }
                        html += '</div>';
                    }
                    html += '</div>';
                }
                $('#board').html(html);
            }

            // Reset the board
            function resetBoard() {
                $('.field').html('');
                $('#msg').html('');
                $('#fill').removeAttr('disabled');
            }

            // Load test board
            function loadTest() {
                const testBoard = [
                    ["8", "0", "0", "0", "0", "0", "0", "0", "0"],
                    ["0", "0", "3", "6", "0", "0", "0", "0", "0"],
                    ["0", "7", "0", "0", "9", "0", "2", "0", "0"],
                    ["0", "5", "0", "0", "0", "7", "0", "0", "0"],
                    ["0", "0", "0", "0", "4", "5", "7", "0", "0"],
                    ["0", "0", "0", "1", "0", "0", "0", "3", "0"],
                    ["0", "0", "1", "0", "0", "0", "0", "6", "8"],
                    ["0", "0", "8", "5", "0", "0", "0", "1", "0"],
                    ["0", "9", "0", "0", "0", "0", "4", "0", "0"],
                ];
                resetBoard();
                fillBoardWithValues(testBoard);
            }

            // Fill board with given values
            function fillBoardWithValues(values) {
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        const value = values[i][j];
                        const cell = $(`#field${i}_${j}`);
                        if (value !== "0") {
                            cell.html(value).addClass('autoFilled');
                        }
                    }
                }
            }

            // Fill the board and solve
            function fillBoard() {
                $('#fill').attr('disabled', true);
                const values = Array.from({ length: gridSize }, () => Array(gridSize).fill({ userInput: false, val: 0 }));

                $('.field').each(function () {
                    const row = parseInt($(this).attr('row'));
                    const col = parseInt($(this).attr('col'));
                    const cellValue = $(this).text();

                    if (cellValue) {
                        values[row][col] = { userInput: true, val: parseInt(cellValue) };
                        $(this).html(`<strong>${cellValue}</strong>`);
                    }
                });

                if (!solveSudoku(values)) {
                    $('#msg').html('Could not solve :(');
                } else {
                    $('#msg').html('Solved :)');
                }
            }

            // Solve Sudoku using backtracking
            function solveSudoku(values) {
                const emptyCell = findEmpty(values);
                if (!emptyCell) return true;

                const [row, col] = emptyCell;
                for (let num = 1; num <= gridSize; num++) {
                    if (isValid(values, row, col, num)) {
                        values[row][col].val = num;
                        if (solveSudoku(values)) return true;
                        values[row][col].val = 0;
                    }
                }
                return false;
            }

            // Find the next empty cell
            function findEmpty(values) {
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        if (values[i][j].val === 0) {
                            return [i, j];
                        }
                    }
                }
                return null;
            }

            // Check if a number is valid in a cell
            function isValid(values, row, col, num) {
                for (let i = 0; i < gridSize; i++) {
                    if (values[row][i].val === num || values[i][col].val === num) {
                        return false;
                    }
                }

                const boxRowStart = row - (row % regionSize);
                const boxColStart = col - (col % regionSize);
                for (let i = boxRowStart; i < boxRowStart + regionSize; i++) {
                    for (let j = boxColStart; j < boxColStart + regionSize; j++) {
                        if (values[i][j].val === num) {
                            return false;
                        }
                    }
                }
                return true;
            }
        });
    </script>
</body>
</html>
